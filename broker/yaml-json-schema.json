{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "MonsterMQ",
  "type": "object",
  "properties": {
    "TCP": {
      "type": "integer",
      "default": 1883
    },
    "WS": {
      "type": "integer",
      "default": 0
    },
    "TCPS": {
      "type": "integer",
      "default": 0,
      "description": "TCP port for SSL connection"
    },
    "WSS": {
      "type": "integer",
      "default": 0,
      "description": "WS port for SSL connection"
    },
    "NodeName": {
      "type": "string",
      "description": "Custom node name for cluster identification (defaults to hostname if not set)"
    },
    "MaxPublishRate": {
      "type": "integer",
      "default": 0,
      "description": "Maximum messages per second a client can publish (0 = unlimited)"
    },
    "MaxSubscribeRate": {
      "type": "integer",
      "default": 0,
      "description": "Maximum messages per second a client can receive (0 = unlimited)"
    },
    "Kafka": {
      "type": "object",
      "properties": {
        "Servers": {
          "type": "string"
        },
        "Bus": {
          "type": "object",
          "default": false,
          "Enabled": {
            "type": "boolean",
            "default": false
          },
          "Topic": {
            "type": "string",
            "default": "monster"
          }
        }
      },
      "required": [
        "Servers"
      ]
    },
    "SessionStoreType": {
      "type": "string",
      "enum": [
        "POSTGRES",
        "CRATEDB",
        "MONGODB",
        "SQLITE"
      ]
    },
    "RetainedStoreType": {
      "type": "string",
      "enum": [
        "MEMORY",
        "HAZELCAST",
        "POSTGRES",
        "CRATEDB",
        "MONGODB",
        "SQLITE"
      ]
    },
    "QueuedMessagesEnabled": {
      "type": "boolean",
      "default": true
    },
    "AllowRootWildcardSubscription": {
      "type": "boolean",
      "default": true,
      "description": "Allow clients to subscribe to '#' (root wildcard). If false, SUBSCRIBE acknowledgements for '#' return failure (0x80) and the client remains connected."
    },
    "MqttTcpServer": {
      "type": "object",
      "description": "MQTT TCP server socket configuration for performance tuning",
      "properties": {
        "MaxMessageSizeKb": {
          "type": "integer",
          "default": 512,
          "description": "Maximum MQTT message size in kilobytes. Messages exceeding this limit are rejected."
        },
        "NoDelay": {
          "type": "boolean",
          "default": true,
          "description": "TCP_NODELAY - disable Nagle's algorithm for immediate packet transmission. Essential for low-latency MQTT and preventing packet corruption under high message rates."
        },
        "ReceiveBufferSizeKb": {
          "type": "integer",
          "default": 512,
          "description": "Socket receive buffer size in kilobytes. Larger buffers handle burst traffic better. Recommended: 512KB for normal load, 1-2MB for high-load scenarios (1000+ msg/sec).",
          "minimum": 8,
          "maximum": 65536
        },
        "SendBufferSizeKb": {
          "type": "integer",
          "default": 512,
          "description": "Socket send buffer size in kilobytes. Should match receive buffer size. Recommended: 512KB for normal load, 1-2MB for high-load scenarios.",
          "minimum": 8,
          "maximum": 65536
        }
      }
    },
    "Logging": {
      "type": "object",
      "description": "System logging configuration",
      "properties": {
        "Mqtt": {
          "type": "object",
          "description": "MQTT log handler configuration",
          "properties": {
            "Enabled": {
              "type": "boolean",
              "description": "Enable MQTT log handler to publish all Java logs to $SYS/syslogs/<node>/<level> topics (fixed at INFO level)",
              "default": false
            }
          }
        },
        "Memory": {
          "type": "object",
          "description": "In-memory log storage configuration",
          "properties": {
            "Enabled": {
              "type": "boolean",
              "description": "Enable in-memory storage of system logs",
              "default": true
            },
            "Entries": {
              "type": "integer",
              "description": "Maximum number of log entries to store in memory (circular buffer)",
              "default": 1000,
              "minimum": 1,
              "maximum": 1000000
            }
          }
        }
      }
    },
    "ConfigStoreType": {
      "type": "string",
      "enum": [
        "POSTGRES",
        "CRATEDB",
        "MONGODB",
        "SQLITE"
      ],
      "description": "Database type for storing archive configuration"
    },
    "Postgres": {
      "type": "object",
      "description": "PostgreSQL database configuration. Supports all store types (sessions, retained messages, archives, metrics, users).",
      "properties": {
        "Url": {
          "type": "string",
          "description": "JDBC connection URL (e.g., jdbc:postgresql://localhost:5432/monstermq)",
          "examples": ["jdbc:postgresql://localhost:5432/monstermq", "jdbc:postgresql://db.example.com:5432/monster"]
        },
        "User": {
          "type": "string",
          "description": "Database username for authentication"
        },
        "Pass": {
          "type": "string",
          "description": "Database password for authentication"
        },
        "Schema": {
          "type": "string",
          "description": "PostgreSQL schema name for storing all MonsterMQ objects. Optional - automatically created if not exists, defaults to 'public' if not specified. Useful for multi-tenant deployments and environment isolation.",
          "pattern": "^[a-zA-Z_][a-zA-Z0-9_]*$",
          "default": "public",
          "examples": ["mqtt_broker", "prod_mq", "staging_mq"]
        }
      },
      "required": [
        "Url",
        "User",
        "Pass"
      ]
    },
    "CrateDB": {
      "type": "object",
      "properties": {
        "Url": {
          "type": "string"
        },
        "User": {
          "type": "string"
        },
        "Pass": {
          "type": "string"
        }
      },
      "required": [
        "Url",
        "User",
        "Pass"
      ]
    },
    "MongoDB": {
      "type": "object",
      "properties": {
        "Url": {
          "type": "string"
        },
        "Database": {
          "type": "string"
        }
      },
      "required": [
        "Url"
      ]
    },
    "SQLite": {
      "type": "object",
      "properties": {
        "Path": {
          "type": "string",
          "description": "Path to SQLite database file",
          "default": "monstermq.db"
        },
        "EnableWAL": {
          "type": "boolean",
          "description": "Enable WAL (Write-Ahead Logging) mode for better performance. Set to false for easier multi-client access.",
          "default": true
        }
      }
    },
    "MCP": {
      "type": "object",
      "description": "Model Context Protocol server configuration",
      "properties": {
        "Enabled": {
          "type": "boolean",
          "description": "Enable MCP server for AI integration",
          "default": true
        },
        "Port": {
          "type": "integer",
          "description": "Port for MCP server HTTP endpoint",
          "default": 3000,
          "minimum": 1,
          "maximum": 65535
        }
      }
    },
    "OaDatapointBridge": {
      "type": "object",
      "description": "Native WinCC OA datapoint bridge configuration. Allows MQTT clients to subscribe to WinCC OA datapoints via $OA/<namespace>/dp/<datapoint> topics. Requires MonsterMQ to run as a WinCC OA manager (MonsterOA entry point).",
      "properties": {
        "Enabled": {
          "type": "boolean",
          "description": "Enable the OA datapoint bridge",
          "default": false
        },
        "Namespace": {
          "type": "string",
          "description": "Namespace identifier for this WinCC OA system (e.g., 's1'). MQTT clients subscribe to $OA/<namespace>/dp/<datapoint> to receive datapoint values."
        }
      }
    },
    "GraphQL": {
      "type": "object",
      "description": "GraphQL server configuration",
      "properties": {
        "Enabled": {
          "type": "boolean",
          "description": "Enable GraphQL server",
          "default": false
        },
        "Port": {
          "type": "integer",
          "description": "Port for GraphQL HTTP endpoint",
          "default": 8080,
          "minimum": 1,
          "maximum": 65535
        },
        "Path": {
          "type": "string",
          "description": "Path for GraphQL endpoint",
          "default": "/graphql"
        },
        "CorsEnabled": {
          "type": "boolean",
          "description": "Enable CORS for GraphQL endpoint",
          "default": true
        }
      }
    },
    "GenAI": {
      "type": "object",
      "description": "Generative AI integration configuration for JavaScript coding assistance",
      "properties": {
        "Enabled": {
          "type": "boolean",
          "description": "Enable GenAI integration for AI-supported JavaScript coding",
          "default": false
        },
        "Provider": {
          "type": "string",
          "description": "AI provider to use",
          "enum": ["gemini", "claude", "openai"],
          "default": "gemini"
        },
        "ApiKey": {
          "type": "string",
          "description": "API key for the selected provider (supports environment variable substitution like ${GENAI_API_KEY})"
        },
        "Model": {
          "type": "string",
          "description": "Optional model name to use (provider-specific, e.g., 'gemini-pro', 'claude-3-opus', 'gpt-4')"
        },
        "MaxTokens": {
          "type": "integer",
          "description": "Maximum number of tokens in the response",
          "default": 2048,
          "minimum": 1,
          "maximum": 100000
        },
        "Temperature": {
          "type": "number",
          "description": "Sampling temperature for response generation (0.0 to 2.0, higher = more creative)",
          "default": 0.7,
          "minimum": 0.0,
          "maximum": 2.0
        },
        "DocsPath": {
          "type": "string",
          "description": "Path to documentation directory containing markdown files for context",
          "default": "docs"
        }
      },
      "required": ["ApiKey"]
    },
    "ArchiveGroups": {
      "type": "array",
      "description": "Archive group configurations",
      "items": {
        "type": "object",
        "properties": {
          "Name": { "type": "string" },
          "TopicFilter": { "type": "array", "items": {"type": "string"} },
          "RetainedOnly": { "type": "boolean", "default": false },
          "LastValType": { "type": "string", "enum": ["MEMORY","HAZELCAST","POSTGRES","CRATEDB","MONGODB","SQLITE","NONE"], "default": "MEMORY" },
          "ArchiveType": { "type": "string", "enum": ["NONE","POSTGRES","CRATEDB","MONGODB","KAFKA","SQLITE"], "default": "NONE" },
          "LastValRetention": { "type": ["string","null"], "description": "Duration like 1h, 30m" },
          "ArchiveRetention": { "type": ["string","null"], "description": "Duration like 24h, 7d" },
          "PurgeInterval": { "type": ["string","null"], "description": "Purge interval duration" },
          "PayloadFormat": { "type": "string", "enum": ["DEFAULT","JSON"], "default": "DEFAULT", "description": "Payload storage format" }
        },
        "required": ["Name","TopicFilter","LastValType","ArchiveType"]
      }
    }
  },
  "required": [
    "TCP"
  ]
}